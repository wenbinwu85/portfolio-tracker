import{b as F}from"./chunk-AP2Z3L3Z.js";import{a as C,b as _,c as x,d as M}from"./chunk-H4ARVKXO.js";import{a as I}from"./chunk-INSALNMJ.js";import{a as b,b as P}from"./chunk-AAWJHOSY.js";import{a as w}from"./chunk-MHWJ3EYT.js";import{Ka as S,La as O,h as D}from"./chunk-LMLYN562.js";import{$a as E,Ab as r,Bb as a,Cb as c,Db as h,Eb as g,Ub as m,Zb as y,_a as l,ja as u,pb as f,rb as s}from"./chunk-YSX44WVI.js";function T(i,o){if(i&1&&(r(0,"div",10),c(1,"info-card",11),a()),i&2){let n=o.$implicit;l(),s("icon","article")("value",n.title)("subtitle",n.symbol)("date",n.displayTime)("fontSize","1rem")("color","slategrey")("accentColor","slategrey")}}function $(i,o){if(i&1&&(r(0,"div",10),c(1,"info-card",12),a()),i&2){let n=o.$implicit;l(),s("icon","thumbs_up_down")("value",n.fromGrade+" --> "+n.toGrade)("subtitle",n.symbol)("additionalInfo",n.firm)("date",n.date)("fontSize","1rem")("color",n.color)("accentColor",n.color)}}function G(i,o){if(i&1&&(h(0),c(1,"info-card",14),g()),i&2){let n=o.$implicit;l(),s("icon",n.icon)("value",n.name)("subtitle",n.event)("date",n.date)("additionalInfo",n.detail)("fontSize","1rem")("color",n.color)("accentColor",n.color)}}function N(i,o){if(i&1&&(h(0),r(1,"div",13),f(2,G,2,8,"ng-container",9),a(),g()),i&2){let n=o.$implicit;l(2),s("ngForOf",n[1])}}var W=(()=>{let o=class o{constructor(e){this.dataService=e,this.events=[],this.eventDates=[],this.mappedEvents={},this.corporateEvents=[],this.gradingEvents=[]}ngOnInit(){Object.values(this.dataService.portfolioData).filter(e=>e.quoteType==="EQUITY").forEach(e=>{if(e.upgradeDowngradeHistory.map(t=>{this.gradingEvents.push({shortName:e.shortName,symbol:e.symbol,date:t.epochGradeDate,firm:t.firm,toGrade:t.toGrade,fromGrade:t.fromGrade,action:t.action,color:t.action==="up"?"teal":t.action==="down"?"chocolate":"slategrey"})}),e.calendarEvents){let t=e.calendarEvents,d=e.earnings.earningsChart,p=this.dataService.portfolioHoldings[e.symbol];if(t.exDividendDate){let v=(e.dividendYield*100).toFixed(2);this.events.push({name:e.shortName,date:new Date(t.exDividendDate).valueOf(),event:"Ex-Dividend",icon:"rule",color:"sienna",detail:`Yield: ${v}%`})}if(t.dividendDate){let v=(e.lastDividendValue*p.sharesOwned).toFixed(2);this.events.push({name:e.shortName,date:new Date(t.dividendDate).valueOf(),event:"Dividend",icon:"attach_money",color:"darkcyan",detail:`Income: $${v}`})}if(t.earnings.earningsDate[0]){let v=`${d.currentQuarterEstimateDate} estimate: ${d.currentQuarterEstimate}`;this.events.push({name:e.shortName,date:new Date(t.earnings?.earningsDate[0]?.slice(0,-2)).valueOf(),event:"Earnings",icon:"insights",color:"slategrey",detail:v})}}this.dataService.getCorporateEvents(e.symbol,!0).subscribe(t=>{this.corporateEvents.push(...t[e.symbol]),this.corporateEvents=this.corporateEvents.sort((d,p)=>p.time-d.time).slice(0,20)})}),this.gradingEvents=this.gradingEvents.sort((e,t)=>{let d=new Date(t.date).valueOf(),p=new Date(e.date).valueOf();return d-p}).slice(0,20),this.events=this.events.filter(e=>e.date>=new Date().valueOf()),this.events.sort((e,t)=>e.date-t.date),this.events.forEach(e=>{this.eventDates.push(e.date)}),this.eventDates=new Set(this.eventDates),this.eventDates=Array.from(this.eventDates),this.eventDates.forEach(e=>{this.mappedEvents[e]=this.events.filter(t=>t.date===e)}),this.mappedEvents=Object.entries(this.mappedEvents)}};o.\u0275fac=function(t){return new(t||o)(E(w))},o.\u0275cmp=u({type:o,selectors:[["app-portfolio-main"]],standalone:!0,features:[y],decls:31,vars:5,consts:[[3,"expanded"],[1,"add-border","main-section"],[1,"events-container"],[1,"title"],["class","add-margin",4,"ngFor","ngForOf"],["vertical",""],[1,"grading-events-container"],[1,"calendar-events-container"],[1,"add-margin","day-container"],[4,"ngFor","ngForOf"],[1,"add-margin"],[3,"icon","value","subtitle","date","fontSize","color","accentColor"],[3,"icon","value","subtitle","additionalInfo","date","fontSize","color","accentColor"],[1,"event-container"],[3,"icon","value","subtitle","date","additionalInfo","fontSize","color","accentColor"]],template:function(t,d){t&1&&(r(0,"mat-expansion-panel",0)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon"),m(4,"auto_graph"),a(),r(5,"span"),m(6,"Price Change"),a()()(),c(7,"stock-price-movement-charts"),a(),r(8,"mat-expansion-panel",0)(9,"mat-expansion-panel-header")(10,"mat-panel-title")(11,"mat-icon"),m(12,"event"),a(),r(13,"span"),m(14,"Events"),a()()(),r(15,"section",1)(16,"div",2)(17,"div",3),m(18,"Corporate"),a(),f(19,T,2,7,"div",4),a(),c(20,"mat-divider",5),r(21,"div",6)(22,"div",3),m(23,"Gradings"),a(),f(24,$,2,8,"div",4),a(),c(25,"mat-divider",5),r(26,"div",7)(27,"div",3),m(28,"Calendar"),a(),r(29,"div",8),f(30,N,3,1,"ng-container",9),a()()()()),t&2&&(s("expanded",!0),l(8),s("expanded",!0),l(11),s("ngForOf",d.corporateEvents),l(5),s("ngForOf",d.gradingEvents),l(6),s("ngForOf",d.mappedEvents))},dependencies:[I,P,b,M,C,_,x,O,S,D,F],styles:[".main-section[_ngcontent-%COMP%]{display:flex}.day-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.event-date[_ngcontent-%COMP%]{margin-top:1rem;padding-bottom:.5rem}.event-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding-bottom:10px}.calendar-events-container[_ngcontent-%COMP%]{min-width:min-content}.grading-events-container[_ngcontent-%COMP%]{min-width:max-content}.calendar-events-container[_ngcontent-%COMP%], .grading-events-container[_ngcontent-%COMP%], .events-container[_ngcontent-%COMP%]{margin-top:.5rem}"]});let i=o;return i})();export{W as a};
