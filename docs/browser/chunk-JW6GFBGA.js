import{b as N}from"./chunk-G7XVXPAY.js";import{a as O,b as P,c as w,d as F}from"./chunk-Q4AKZG62.js";import{la as G}from"./chunk-EJFO3ZPI.js";import{a as x,b as S}from"./chunk-AW3653M6.js";import{a as $}from"./chunk-ZADWSM2P.js";import{Ra as I,Sa as T,h as M,m as _}from"./chunk-O4DPZORS.js";import{$a as E,Bb as d,Cb as o,Db as m,Eb as u,Fb as h,Vb as c,Wb as C,_a as l,_b as y,dc as b,fc as D,ja as g,pb as f,sb as s}from"./chunk-FXNQBJ5A.js";function z(i,a){if(i&1&&(d(0,"div",0),m(1,"info-card",12),o()),i&2){let n=a.$implicit;l(),s("icon","article")("value",n.title)("subtitle",n.symbol)("date",n.displayTime)("fontSize","1rem")("color","steelblue")("accentColor","steelblue")("subtitleChip",!0)}}function Q(i,a){if(i&1&&(d(0,"div",0),m(1,"info-card",13),o()),i&2){let n=a.$implicit;l(),s("icon","thumbs_up_down")("value",n.fromGrade+" --> "+n.toGrade)("subtitle",n.symbol)("additionalInfo",n.firm)("date",n.date)("fontSize","1rem")("color",n.color)("accentColor",n.color)("subtitleChip",!0)}}function Y(i,a){if(i&1&&(u(0),m(1,"info-card",16),h()),i&2){let n=a.$implicit;l(),s("icon",n.icon)("value",n.name)("subtitle",n.event)("additionalInfo",n.detail)("fontSize","1rem")("color",n.color)("accentColor",n.color)}}function j(i,a){if(i&1&&(u(0),d(1,"div",14),c(2),b(3,"date"),o(),d(4,"div",15),f(5,Y,2,7,"ng-container",11),o(),h()),i&2){let n=a.$implicit;l(2),C(D(3,2,n[0],"MMMM d, EEEE")),l(3),s("ngForOf",n[1])}}var te=(()=>{let a=class a{constructor(e){this.dataService=e,this.events=[],this.eventDates=[],this.mappedEvents={},this.corporateEvents=[],this.gradingEvents=[]}ngOnInit(){Object.values(this.dataService.portfolioData).filter(e=>e.quoteType==="EQUITY").forEach(e=>{if(e.upgradeDowngradeHistory.map(t=>{this.gradingEvents.push({shortName:e.shortName,symbol:e.symbol,date:t.epochGradeDate,firm:t.firm,toGrade:t.toGrade,fromGrade:t.fromGrade,action:t.action,color:t.action==="up"?"teal":t.action==="down"?"chocolate":"steelblue"})}),e.calendarEvents){let t=e.calendarEvents,r=e.earnings?.earningsChart,p=this.dataService.portfolioHoldings[e.symbol];if(t.exDividendDate){let v=(e.dividendYield*100).toFixed(2);this.events.push({symbol:e.symbol,name:e.shortName,date:new Date(t.exDividendDate).valueOf(),event:"Ex-Dividend",icon:"rule",color:"chocolate",detail:`Yield: ${v}%`})}if(t.dividendDate){let v=(e.lastDividendValue*p.sharesOwned).toFixed(2);this.events.push({symbol:e.symbol,name:e.shortName,date:new Date(t.dividendDate).valueOf(),event:"Dividend",icon:"attach_money",color:"teal",detail:`Income: $${v}`})}if(r.earningsDate[0]){let v=`${r.currentQuarterEstimateDate} estimate: ${r.currentQuarterEstimate}`;this.events.push({symbol:e.symbol,name:e.shortName,date:new Date(r.earningsDate[0]?.slice(0,-2)).valueOf(),event:"Earnings",icon:"insights",color:"steelblue",detail:v})}}this.dataService.getCorporateEvents(e.symbol,!0).subscribe(t=>{this.corporateEvents.push(...t[e.symbol]),this.corporateEvents=this.corporateEvents.sort((r,p)=>p.time-r.time).slice(0,25)})}),this.gradingEvents=this.gradingEvents.sort((e,t)=>{let r=new Date(t.date).valueOf(),p=new Date(e.date).valueOf();return r-p}).slice(0,25),this.events.sort((e,t)=>e.date-t.date),this.events.forEach(e=>this.eventDates.push(e.date)),this.eventDates=new Set(this.eventDates),this.eventDates=Array.from(this.eventDates),this.eventDates.forEach(e=>{this.mappedEvents[e]=this.events.filter(t=>t.date===e)}),this.mappedEvents=Object.entries(this.mappedEvents)}};a.\u0275fac=function(t){return new(t||a)(E($))},a.\u0275cmp=g({type:a,selectors:[["app-portfolio-main"]],standalone:!0,features:[y],decls:25,vars:5,consts:[[1,"add-margin"],[3,"expandQuotes"],[3,"expanded"],[1,"add-border","main-section"],[1,"corp-events-container"],[1,"title"],["class","add-margin",4,"ngFor","ngForOf"],["vertical",""],[1,"grading-events-container"],[1,"calendar-events-container"],[1,"add-margin","day-container"],[4,"ngFor","ngForOf"],[3,"icon","value","subtitle","date","fontSize","color","accentColor","subtitleChip"],[3,"icon","value","subtitle","additionalInfo","date","fontSize","color","accentColor","subtitleChip"],[1,"event-date"],[1,"event-container"],[3,"icon","value","subtitle","additionalInfo","fontSize","color","accentColor"]],template:function(t,r){t&1&&(d(0,"section",0),m(1,"stock-price-movement-charts",1),o(),d(2,"mat-expansion-panel",2)(3,"mat-expansion-panel-header")(4,"mat-panel-title")(5,"mat-icon"),c(6,"event"),o(),d(7,"span"),c(8,"Events"),o()()(),d(9,"section",3)(10,"div",4)(11,"div",5),c(12,"Corporate"),o(),f(13,z,2,8,"div",6),o(),m(14,"mat-divider",7),d(15,"div",8)(16,"div",5),c(17,"Gradings"),o(),f(18,Q,2,9,"div",6),o(),m(19,"mat-divider",7),d(20,"div",9)(21,"div",5),c(22,"Calendar"),o(),d(23,"div",10),f(24,j,6,5,"ng-container",11),o()()()()),t&2&&(l(),s("expandQuotes",!0),l(),s("expanded",!1),l(11),s("ngForOf",r.corporateEvents),l(5),s("ngForOf",r.gradingEvents),l(6),s("ngForOf",r.mappedEvents))},dependencies:[_,G,S,x,F,O,P,w,T,I,M,N],styles:[".main-section[_ngcontent-%COMP%]{display:flex}.day-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.event-date[_ngcontent-%COMP%]{margin-top:1rem;padding-bottom:.5rem}.event-date[_ngcontent-%COMP%]:first-of-type{margin-top:0}.event-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding-bottom:10px}.corp-events-container[_ngcontent-%COMP%], .grading-events-container[_ngcontent-%COMP%], .calendar-events-container[_ngcontent-%COMP%]{margin-top:.5rem}.grading-events-container[_ngcontent-%COMP%], .calendar-events-container[_ngcontent-%COMP%]{min-width:max-content}"]});let i=a;return i})();export{te as a};
