import{b as x}from"./chunk-NOVPQLPH.js";import{a as I,b as A,f as E}from"./chunk-RGQZAJBQ.js";import{k as P}from"./chunk-Z4PAFYLC.js";import{i as _}from"./chunk-AWCSJ736.js";import{a as T,b as C,c as M,o as h}from"./chunk-2WYAVOGU.js";import{Ab as m,B as y,Bb as d,M as w,Wa as l,X as D,Xa as u,_b as H,aa as f,fa as S,l as v,pb as c,xb as b,yb as g,zb as p}from"./chunk-6PRU6VJY.js";var j=(()=>{let r=class r{constructor(t,i){this.http=t,this.dataService=i,this.apiBaseUrl="https://data.alpaca.markets",this.apiKey="PK41CNLBVKS2CHYHD6FQ",this.secretKey="hOurdDodVN23wnjowMOyXYjeaobsmIbXtqhOwSbE",this.httpHeaders=new T().set("APCA-API-KEY-ID",this.apiKey).set("APCA-API-SECRET-KEY",this.secretKey)}error(t){let i=t.error instanceof ErrorEvent?t.error.message:`Error Code: ${t.status} Message: ${t.message}`;return v({data:[],message:i,status:500})}wrapHttpCall(t,i){return this.http.get(t,i).pipe(w(2),y(this.error))}getLatestBars(){let t=this.dataService.portfolioSymbols,i=this.apiBaseUrl+"/v2/stocks/bars/latest",n=new C().appendAll({symbols:t.join(","),feed:"iex"}),s={headers:this.httpHeaders,params:n};return this.wrapHttpCall(i,s)}getNews(t,i,n,s){let e=this.apiBaseUrl+"/v1beta1/alpaca/fetch/news/",F=new C().appendAll({symbols:t.join(","),start:i,end:n,limit:s}),G={headers:this.httpHeaders,params:F};return this.wrapHttpCall(e,G)}};r.\u0275fac=function(i){return new(i||r)(f(M),f(h))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var W=(o,r)=>r.epochGradeDate,U=(o,r)=>r.index;function $(o,r){if(o&1&&d(0,"info-card",6)(1,"div",7),o&2){let a=r.$implicit;c("value",a.fromGrade+" to "+a.toGrade)("subtitle",a.symbol)("subtitleChip",!0)("additionalInfo",a.firm)("date",(a.epochGradeDate*1e3).toString())("icon",a.icon)("color",a.color)}}function B(o,r){if(o&1&&d(0,"info-card",6)(1,"div",7),o&2){let a=r.$implicit;c("value",a.shares.fmt+" shares. "+a.transactionText)("subtitle",a.symbol)("subtitleChip",!0)("additionalInfo",a.filerName+", "+a.filerRelation)("date",(a.startDate.raw*1e3).toString())("icon",a.icon)("color",a.color)}}var rt=(()=>{let r=class r{constructor(t,i){this.alpacaApiService=t,this.dataService=i,this.selectedChart=1,this.gradingHistory=[],this.insiderActivities=[]}ngOnInit(){this.dataService.portfolioDataArray.forEach(t=>{let i={up:"thumb_up",down:"thumb_down",main:"thumbs_up_down",reit:"thumbs_up_down"};if(t.quoteType==="EQUITY"){let n=Object.values(t.upgradeDowngradeHistory).filter(e=>new Date(e.epochGradeDate*1e3).getFullYear()===new Date().getFullYear()).map(e=>(e.symbol=t.symbol,e.icon=i[e.action],e.action==="up"&&(e.color="teal"),e.action==="down"&&(e.color="chocolate"),e));this.gradingHistory.push(...n);let s=t.insiderTransactions;s.length>0&&this.insiderActivities.push(...s.filter(e=>new Date(e.startDate.raw*1e3).getFullYear()===new Date().getFullYear()&&(e.transactionText.startsWith("Purchase")||e.transactionText.startsWith("Sale"))).map(e=>(e.symbol=t.symbol,e.transactionText.startsWith("Purchase")?(e.icon="sentiment_very_satisfied",e.color="teal"):e.transactionText.startsWith("Sale")&&(e.icon="sentiment_very_dissatisfied",e.color="chocolate"),e)))}}),this.gradingHistory.sort((t,i)=>i.epochGradeDate-t.epochGradeDate),this.insiderActivities.sort((t,i)=>i.startDate.raw-t.startDate.raw)}selectChart(t){this.selectedChart=t}};r.\u0275fac=function(i){return new(i||r)(u(j),u(h))},r.\u0275cmp=S({type:r,selectors:[["app-portfolio-main"]],standalone:!0,features:[H],decls:12,vars:1,consts:[["mat-align-tabs","center"],["label","Quotes"],[1,"add-margin"],[3,"expandWidget"],["label","Grading History"],["label","Insider Activities"],[3,"value","subtitle","subtitleChip","additionalInfo","date","icon","color"],[1,"spacer"]],template:function(i,n){i&1&&(p(0,"mat-tab-group",0)(1,"mat-tab",1)(2,"section",2),d(3,"portfolio-quotes",3),m()(),p(4,"mat-tab",4)(5,"section",2),b(6,$,2,7,null,null,W),m()(),p(8,"mat-tab",5)(9,"section",2),b(10,B,2,7,null,null,U),m()()()),i&2&&(l(3),c("expandWidget",!0),l(3),g(n.gradingHistory),l(4),g(n.insiderActivities))},dependencies:[P,_,E,I,A,x],styles:[".grading-history-container[_ngcontent-%COMP%]{display:flex}.spacer[_ngcontent-%COMP%]{height:.5rem}info-card[_ngcontent-%COMP%]{min-width:fit-content}"]});let o=r;return o})();export{rt as a};
