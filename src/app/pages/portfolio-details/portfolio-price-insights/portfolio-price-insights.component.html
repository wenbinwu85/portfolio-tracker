<portfolio-quotes [expandWidget]="false"/>

<ng-template #priceInsightsRef>
    <portfolio-ticker-buttons (selectedTicker)="updateSelectedStock($event)" />
    @if (selectedSymbol) {
        <stock-price-insight [symbol]="selectedSymbol" />
    }
</ng-template>

<container-card 
    title="Price Insights"
    [mainContentRef]="priceInsightsRef"
/>

<ng-template #performanceChartsRef>
    @if (selectedPerformanceChart === 1) {
        <div class="add-flex">
            <div class="chart-container">
                <ngx-charts-bar-vertical
                    [scheme]="performanceChartColorScheme"
                    [results]="fiftyDayMAChartData"
                    [animations]="true"
                    [xAxis]="true"
                    [yAxis]="true"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [legend]="false"
                    [rotateXAxisTicks]="true"
                    [yAxisLabel]="'Price vs 50 Day Moving Average %'"
                    [yScaleMin]="fiftyDayMAChartData[0].value - 5"
                    [customColors]="[selectedSymbolColor]"
                    [roundEdges]="false"
                >
                </ngx-charts-bar-vertical>
            </div> 
            <div class="chart-container">
                <ngx-charts-bar-vertical
                    [scheme]="performanceChartColorScheme"
                    [results]="twoHundredDayMAChartData"
                    [animations]="true"
                    [xAxis]="true"
                    [yAxis]="true"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [legend]="false"
                    [rotateXAxisTicks]="true"
                    [yAxisLabel]="'Price vs 200 Day Moving Average %'"
                    [yScaleMin]="twoHundredDayMAChartData[0].value - 5"
                    [customColors]="[selectedSymbolColor]"
                    [roundEdges]="false"
                >
                </ngx-charts-bar-vertical>
            </div> 
        </div>

        <mat-divider></mat-divider>

        <div class="add-flex">
            <div class="chart-container">
                <ngx-charts-bar-vertical
                    [scheme]="fiftyTwoWeekChartColorScheme"
                    [results]="fiftyTwoWeekLowChartData"
                    [animations]="true"
                    [xAxis]="true"
                    [yAxis]="true"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [legend]="false"
                    [rotateXAxisTicks]="true"
                    [yAxisLabel]="'Price above 52 week low %'"
                    [customColors]="[selectedSymbolColor]"
                    [roundEdges]="false"
                >
                </ngx-charts-bar-vertical>
            </div>
            <div class="chart-container">
                <ngx-charts-bar-vertical
                    [scheme]="fiftyTwoWeekChartColorScheme"
                    [results]="fiftyTwoWeekHighChartData"
                    [animations]="true"
                    [xAxis]="true"
                    [yAxis]="true"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [legend]="false"
                    [rotateXAxisTicks]="true"
                    [yAxisLabel]="'Price below 52 week high %'"
                    [customColors]="[selectedSymbolColor]"
                    [roundEdges]="false"
                >
                </ngx-charts-bar-vertical>
            </div>
        </div>

        <mat-divider></mat-divider>

        <!-- <div class="add-flex">
            <div class="chart-container">
                <ngx-charts-bar-vertical
                    [scheme]="performanceChartColorScheme"
                    [results]="fiftyTwoWeekChangeChartData"
                    [animations]="true"
                    [xAxis]="true"
                    [yAxis]="true"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [legend]="false"
                    [rotateXAxisTicks]="true"
                    [yAxisLabel]="'52 Week Change %'"
                    [activeEntries]="['S&P 500']"
                    [customColors]="[selectedSymbolColor, {name:'S&P 500', value: 'gold'}]"
                    [roundEdges]="false"
                >
                </ngx-charts-bar-vertical>
            </div>
            <div class="chart-container">
                <ngx-charts-bar-vertical
                    [scheme]="targetPriceChartColorScheme"
                    [results]="meanTargetPriceData"
                    [animations]="true"
                    [xAxis]="true"
                    [yAxis]="true"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [legend]="false"
                    [rotateXAxisTicks]="true"
                    [yScaleMin]="-5"
                    [yAxisLabel]="'Price vs mean target price %'"
                    [customColors]="[selectedSymbolColor]"
                    [roundEdges]="false"
                >
                </ngx-charts-bar-vertical>
            </div>
        </div> -->

        <div class="add-flex">
            <div class="chart-container">
                <ngx-charts-bar-vertical
                    [scheme]="targetPriceChartColorScheme"
                    [results]="lowTargetPriceData"
                    [animations]="true"
                    [xAxis]="true"
                    [yAxis]="true"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [legend]="false"
                    [rotateXAxisTicks]="true"
                    [yScaleMin]="-5"
                    [yAxisLabel]="'Price vs low target price %'"
                    [customColors]="[selectedSymbolColor]"
                    [roundEdges]="false"
                >
                </ngx-charts-bar-vertical>
            </div> 
            <div class="chart-container">
                <ngx-charts-bar-vertical
                    [scheme]="targetPriceChartColorScheme"
                    [results]="highTargetPriceData"
                    [animations]="true"
                    [xAxis]="true"
                    [yAxis]="true"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [legend]="false"
                    [rotateXAxisTicks]="true"
                    [yScaleMin]="-5"
                    [yAxisLabel]="'Price vs high target price %'"
                    [customColors]="[selectedSymbolColor]"
                    [roundEdges]="false"
                >
                </ngx-charts-bar-vertical>
            </div> 
        </div>
    }
    @if (selectedPerformanceChart === 2) {
        <!-- @let colors = [customColors]="[
            {name: 'SCHD', value: 'deepskyblue'},
            {name: 'VYM', value: 'maroon'}, 
            {name: 'JEPI', value: 'dodgerblue'}
        ]"; -->
        <div class="chart-container">
            <ngx-charts-bar-vertical-2d
                [results]="etfPerformanceChartData"
                [animations]="true"
                [xAxis]="true"
                [yAxis]="true"
                [showXAxisLabel]="true"
                [showYAxisLabel]="true"
                [legend]="true"
                [legendTitle]="'Tickers'"
                [showDataLabel]="true"
                [rotateXAxisTicks]="true"
                [yAxisLabel]="'ETF Performance %'"
                [roundEdges]="false"
            >
            </ngx-charts-bar-vertical-2d>
        </div>
    }
</ng-template>

<ng-template #performanceChartsTitleRef>
    <mat-chip-listbox>
        @if (sortedStocks.length > 0) {
            <mat-chip-option 
                [selected] = "selectedPerformanceChart === 1"
                (click)="changePerformanceChart(1)"
            >
                Stocks
            </mat-chip-option>
        }
        @if (sortedEtfs.length > 0) {
            <mat-chip-option 
                [selected] = "selectedPerformanceChart === 2"
                (click)="changePerformanceChart(2)"
            >
                ETFs
            </mat-chip-option>
        }
    </mat-chip-listbox>
</ng-template>

<container-card 
    title="Performance Charts"
    [mainContentRef]="performanceChartsRef"
    [titleContentRef]="performanceChartsTitleRef"
/>
