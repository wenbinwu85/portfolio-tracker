<section class="add-border">
  <div class="title">
    <span>Allocations & Cost Basis</span>
      </div>

  <div class="charts-flex">
    <div class="chart-container">
      <ngx-charts-pie-grid [scheme]="'forest'" [animations]="true" [results]="totalCostChartData" />
    </div>
  </div>
</section>

<div class="table-actions">
  <mat-slide-toggle (toggleChange)="tradingviewWidgetToggleHandler()">
    <span>Live Widgets</span>
  </mat-slide-toggle>
  <mat-form-field appearance="outline">
    <mat-label>Filter</mat-label>
    <input matInput (keyup)="applyFilter($event)" #input />
  </mat-form-field>
</div>

<table mat-table matSort matSortActive="unrealizedGainPercent" matSortDirection="desc" multiTemplateDataRows
  [dataSource]="dataSource">
  <ng-container *ngFor="let column of columnDefs; index as cidx" [matColumnDef]="column" [sticky]="cidx === 0">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      {{ headers[cidx] }}
    </th>
    <td mat-cell *matCellDef="let stock">
      <div *ngIf="cidx === 0" class="table-col-0">
        <stock-ticker-name *ngIf="!displayTradingviewWidgets" [stock]="stock" />
        <tv-single-quote-widget *ngIf="displayTradingviewWidgets" [symbol]="stock.symbol" class="single-quote-widget" />
      </div>

      <div *ngIf="cidx === 1; else elseBlock" (click)="expandRow(stock)">
        <div class="cost-average">
          <span disabled value="costAverage" [ngStyle]="{ color: getColColor(stock, cidx) }">
            ${{ portfolioHoldings[stock.symbol].costAverage }}
          </span>
          <span disabled value="shares" [ngStyle]="{ color: 'slateblue' }">
            x{{ portfolioHoldings[stock.symbol].sharesOwned }}
          </span>
        </div>
      </div>

      <div *ngIf="cidx === 11">
        <span [ngStyle]="{ color: getColColor(stock, cidx) }" (click)="expandRow(stock)">
          {{ stock.rating | titlecase }}
        </span>
      </div>

      <ng-template #elseBlock>
        <span [ngStyle]="{ color: getColColor(stock, cidx) }" (click)="expandRow(stock)">
          {{ cells[cidx](stock) }}
        </span>
      </ng-template>
    </td>

    <td mat-footer-cell *matFooterCellDef [ngStyle]="{ color: 'black' }">
      {{ footerRow[cidx]() }}
    </td>
  </ng-container>

  <ng-container matColumnDef="expandedRow">
    <td mat-cell *matCellDef="let stock" [attr.colspan]="columnDefs.length">
      <div class="expanded-stock-detail" [@detailExpand]="stock === expandedRow ? 'expanded' : 'collapsed'">
        <expanded-row *ngIf="expandedRow && expandedRow.symbol === stock.symbol" [stock]="stock" />
      </div>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="columnDefs; sticky: true"></tr>
  <tr mat-row *matRowDef="let row; columns: columnDefs" class="stock-row"
    [class.expanded-stock-row]="expandedRow === row"></tr>
  <tr mat-row *matRowDef="let row; columns: ['expandedRow']" class="expanded-stock-row"></tr>
  <tr mat-footer-row *matFooterRowDef="columnDefs; sticky: true"></tr>

  <tr *matNoDataRow class="mat-row">
    <td class="mat-cell" colspan="4">
      Wow! No data matching: {{ input.value }}
    </td>
  </tr>
</table>