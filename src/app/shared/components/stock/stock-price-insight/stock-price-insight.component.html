@if (technicalInsights; as ti) {
    <section class="price-insight">
        <table mat-table [dataSource]="getTableDataSource()">
            <ng-container matColumnDef="symbol">
                <th mat-header-cell *matHeaderCellDef>Symbol</th>
                <td mat-cell *matCellDef="let element">
                    <!-- <span>{{ element.symbol }}</span>
                    <span [ngStyle]="{color: 'teal'}"> {{ element.regularMarketPrice | currency }}</span> -->
                    <stock-ticker-chip [stock]="stockData" />
                </td>
            </ng-container>
            @if (ti.instrumentInfo?.keyTechnicals?.support) {
                <ng-container matColumnDef="support">
                    <th mat-header-cell *matHeaderCellDef>Support</th>
                    <td mat-cell *matCellDef="let element">
                        <span>{{ ti.instrumentInfo?.keyTechnicals?.support }}</span>
                        <span [ngStyle]="{color: 'teal'}"> {{(element.regularMarketPrice?.raw - ti.instrumentInfo?.keyTechnicals?.support).toFixed(2) }}</span>
                    </td>
                </ng-container>
            }
            <ng-container matColumnDef="resistance">
                <th mat-header-cell *matHeaderCellDef>Resistance</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{ ti.instrumentInfo.keyTechnicals.resistance }}</span>
                    <span [ngStyle]="{color: 'chocolate'}"> {{ (element.regularMarketPrice.raw - ti.instrumentInfo.keyTechnicals.resistance).toFixed(2)}} </span>
                </td>
            </ng-container>
            <ng-container matColumnDef="stopLoss">
                <th mat-header-cell *matHeaderCellDef>Stop Loss</th>
                <td mat-cell *matCellDef="let element"> {{ ti.instrumentInfo.keyTechnicals.stopLoss.toFixed(2) }}</td>
            </ng-container>
            <ng-container matColumnDef="fiftyTwoWeekLow">
                <th mat-header-cell *matHeaderCellDef>52 Week Low</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{ element.fiftyTwoWeekLow.raw }}</span>
                    <span [ngStyle]="{color: 'teal'}"> +{{ (element.regularMarketPrice.raw - element.fiftyTwoWeekLow.raw).toFixed(2) }}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="dayLow">
                <th mat-header-cell *matHeaderCellDef>Day Low</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{ element.dayLow.raw }}</span>
                    <span [ngStyle]="{color: 'teal'}"> +{{( element.regularMarketPrice.raw - element.dayLow.raw).toFixed(2) }}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="dayHigh">
                <th mat-header-cell *matHeaderCellDef>Day High</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{ element.dayHigh.raw }}</span>
                    <span [ngStyle]="{color: 'chocolate'}"> {{ (element.regularMarketPrice.raw - element.dayHigh.raw).toFixed(2) }}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="fiftyTwoWeekHigh">
                <th mat-header-cell *matHeaderCellDef>52 Week High</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{ element.fiftyTwoWeekHigh.raw }}</span>
                    <span [ngStyle]="{color: 'chocolate'}"> {{ (element.regularMarketPrice.raw - element.fiftyTwoWeekHigh.raw).toFixed(2) }}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="targetLowPrice">
                <th mat-header-cell *matHeaderCellDef>Target Price Low</th>
                <td mat-cell *matCellDef="let element">
                    <span> {{ (element.targetLowPrice?.raw - element.regularMarketPrice?.raw) / element.regularMarketPrice?.raw | percent: '.2' }}</span>
                    @if (stockData.quoteType === 'EQUITY') {
                        <span [ngStyle]="{color: 'teal'}"> ({{ element.targetLowPrice.raw }})</span>
                    }
                </td>
            </ng-container>
            <ng-container matColumnDef="targetMedianPrice">
                <th mat-header-cell *matHeaderCellDef>Target Price Median</th>
                <td mat-cell *matCellDef="let element">
                    <span> {{ (element.targetMedianPrice?.raw - element.regularMarketPrice?.raw) / element.regularMarketPrice?.raw | percent: '.2' }}</span>
                    @if (stockData.quoteType === 'EQUITY') {
                        <span [ngStyle]="{color: 'teal'}"> ( {{ element.targetMedianPrice.raw }} )</span>
                    }
                </td>
            </ng-container>
            <ng-container  matColumnDef="targetHighPrice">
                <th mat-header-cell *matHeaderCellDef>Target Price High</th>
                <td mat-cell *matCellDef="let element">
                    <span> {{ (element.targetHighPrice?.raw - element.regularMarketPrice?.raw) / element.regularMarketPrice?.raw | percent: '.2' }}</span>
                    @if (stockData.quoteType === 'EQUITY') {
                        <span [ngStyle]="{color: 'teal'}"> ({{ element.targetHighPrice.raw }})</span>
                    }
                </td>
            </ng-container>
            <!-- <ng-container matColumnDef="argusTarget">
                <th mat-header-cell *matHeaderCellDef>Argus Research Target</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{ ti?.recommendation?.targetPrice | currency }}</span>
                    @if (stockData.quoteType === 'EQUITY') {
                        <span> ({{ ti?.recommendation?.rating }})</span>
                    }
                </td>
            </ng-container>
            <ng-container matColumnDef="tradingCentral">
                <th mat-header-cell *matHeaderCellDef>Trading Central Valuation</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{ ti?.instrumentInfo?.valuation.description }}</span>
                    @if (stockData.quoteType === 'EQUITY') {
                        <span> ({{ ti?.instrumentInfo?.valuation.discount }})</span>
                    }
                </td>
            </ng-container> -->
            <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: tableColumns;"></tr>
        </table>
    
        <mat-divider />
    
        @if (stockData) {
            <h3>Day Range vs 52 Week Range</h3>
            <stock-day-price-range 
                [min]="stockData.fiftyTwoWeekLow.raw" 
                [max]="stockData.fiftyTwoWeekHigh.raw"
                [lowThumbValue]="stockData.dayLow.raw"
                [highThumbValue]="stockData.dayHigh.raw"
                [showThumbs]="false" 
            />
        }
    </section>
}